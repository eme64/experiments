<!DOCTYPE html>
<html>

<body>

TODO

<iframe id = "issue_graph" height="800" width="100%" resize="both" overflow="auto">
</iframe>

<script>
  maxX = 100;
  maxY = 100;

  issues = {}

  graph_document = undefined;

  function updateMax(x,y) {
    maxX = Math.max(maxX,x);
    maxY = Math.max(maxY,y);
  }

  function updateCanvas(overFocusId) {
    var universe = graph_document.getElementById("universe")
    var canv = graph_document.getElementById("mainCanvas")
    canv.width = maxX + 405;
    canv.height = maxY + 25;

    var ctx = canv.getContext("2d");
    ctx.clearRect(0, 0, canv.width, canv.height);
    ctx.rect(0, 0, canv.width, canv.height);
    ctx.fillStyle = "#eeeeee";
    ctx.fill();

    // Draw edges
    for (const [name, issue] of Object.entries(issues)) {
      for (var edge of issue.edges) {
        var issue2 = issues[edge.name];
        var x1 = issue.x - 10;
        var y1 = issue.y + 10;
        var x2 = issue2.x - 10;
        var y2 = issue2.y + 10;
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.bezierCurveTo(x1, y1-50, x2, y2+50, x2, y2);
        ctx.strokeStyle = edge.color;
        ctx.stroke();
      }
    }

    // Draw issues
    for (const [name, issue] of Object.entries(issues)) {
      var div = issue.div;

      if (overFocusId==div.id) {
        div.style.border = "solid #000000 1px";
      } else {
        div.style.border = "";
      }

      ctx.beginPath();
      ctx.arc(issue.x - 10, issue.y + 10, 5, 0, 2 * Math.PI);
      ctx.fillStyle = "red";
      ctx.fill();
      ctx.stroke();
    }
  }

  function addIssue(issue) {
    var universe = graph_document.getElementById('universe')
    universe.style.position = "absolute";
    var div = graph_document.createElement("myelement");
    div.style.position = "absolute";
    div.style.width = "400px";
    div.style.height = "20px";
    div.style.background = "#ffffff";
    div.style.color = "black";
    div.innerHTML = "<a href='https://bugs.openjdk.org/browse/JDK-" + issue.name
                    + "' style='font-size:14px' target='_blank'>"
                    + issue.name + ": " + issue.desc + "</a>";
    if (issue.pr != "") {
      div.innerHTML += " <a href='" + issue.pr
                       + "' style='font-size:14px' target='_blank'>[PR]</a>";
    }

    div.style.left = issue.x+"px";
    div.style.top  = issue.y+"px";
    updateMax(issue.x, issue.y);

    div.id = issue.name;
    universe.appendChild(div);

    div.onmouseover = function() {mouseOverIssue(div.id);}

    return div;
  }

  function mouseOverIssue(id) {
    updateCanvas(id);
  }

  function init() {
    var graph_frame = document.getElementById("issue_graph")
    graph_document = graph_frame.contentWindow.document

    var div = graph_document.createElement("div");
    graph_document.body.appendChild(div);

    var universe =  graph_document.createElement('universe');
    universe.id = "universe";
    div.appendChild(universe);

    var canv = graph_document.createElement('canvas');
    canv.id = 'mainCanvas';
    universe.appendChild(canv);

    issues = {};

    issues["8346993"] = {desc:"Refactor VectorNode::make",
                         pr: "https://github.com/openjdk/jdk/pull/22917",
                         x: 20, y: 10, type: "review",
                         edges: []};
    issues["8343685"] = {desc:"Revactor VPointer with MemPointer",
                         pr: "https://github.com/openjdk/jdk/pull/21926",
                         x: 200, y: 50, type: "open",
                         edges: [{name: "8346993", color: "black"}]};

    for (const [name, issue] of Object.entries(issues)) {
      issue.name = name;
      div = addIssue(issue)
      issue.div = div;
    }

    updateCanvas()
  }

  init()
</script>

TODO

</body>
</html>
